<!DOCTYPE html>
<html
  th:replace="~{modules/layout :: html (title = '瞬间详情', content = ~{::content}, layout = 'page', breadcrumb = ~{::breadcrumb})}"
  xmlns:th="https://www.thymeleaf.org"
>
  <th:block th:fragment="breadcrumb">
    <span>
      <a href="/">[[#{breadcrumb.home}]]</a>
    </span>
    <span>
      <a href="/moments">瞬间</a>
    </span>
    <span>
      [[${moment.spec.releaseTime != null ? #dates.format(moment.spec.releaseTime,'yyyy-MM-dd HH:mm') : moment.metadata.name}]]
    </span>
  </th:block>

  <div id="page-moment" class="ps-lg-2" th:fragment="content">
    <article class="card card-body border-0 shadow-sm">
      <header class="mb-4" th:with="author=${moment.owner}, stats=${moment.stats}">
        <h1 class="h3 d-flex align-items-center gap-2 mb-3">
          <i class="fa fa-bolt text-warning"></i>
          <span>瞬间</span>
        </h1>
        <div class="d-flex flex-wrap align-items-center gap-3 small text-muted">
          <span th:if="${moment.spec.releaseTime != null}">
            <i class="far fa-clock me-1"></i>
            [[${#dates.format(moment.spec.releaseTime,'yyyy-MM-dd HH:mm')}]]
          </span>
          <span class="d-flex align-items-center" th:if="${author != null}">
            <img
              th:if="${author.avatar != null}"
              th:src="${author.avatar}"
              alt="author-avatar"
              class="rounded-circle me-2"
              width="28"
              height="28"
              loading="lazy"
            />
            <i class="far fa-user me-1" th:unless="${author.avatar != null}"></i>
            [[${author.displayName != null ? author.displayName : author.name}]]
          </span>
          <span th:if="${stats != null}">
            <i class="far fa-comment-dots me-1"></i>
            [[${stats.totalComment}]] 评论
          </span>
          <span th:if="${stats != null}">
            <i class="far fa-thumbs-up me-1"></i>
            [[${stats.upvote}]] 赞
          </span>
        </div>
      </header>

      <section th:with="content=${moment.spec.content}">
        <div
          class="moment-content mb-4"
          th:if="${content != null and not #strings.isEmpty(content.html)}"
          th:utext="${content.html}"
        ></div>

        <div class="moment-media row g-3" th:if="${content != null and not #lists.isEmpty(content.medium)}">
          <th:block th:each="momentItem, iterStat : ${content.medium}">
            <div class="col-12" th:classappend="${#lists.size(content.medium) > 1 ? ' col-md-6' : ''}">
              <figure class="moment-media-item mb-0">
                <img
                  class="img-fluid rounded"
                  th:if="${momentItem.type.name == 'PHOTO'}"
                  th:src="${momentItem.url}"
                  th:alt="${momentItem.name != null ? momentItem.name : 'moment-photo-' + iterStat.count}"
                  loading="lazy"
                />
                <video
                  class="w-100 rounded"
                  th:if="${momentItem.type.name == 'VIDEO'}"
                  th:src="${momentItem.url}"
                  controls
                ></video>
                <audio
                  class="w-100"
                  th:if="${momentItem.type.name == 'AUDIO'}"
                  th:src="${momentItem.url}"
                  controls
                ></audio>
              </figure>
            </div>
          </th:block>
        </div>
      </section>

      <section
        class="moment-tags mt-4"
        th:if="${not #lists.isEmpty(moment.spec.tags)}"
      >
        <span class="text-muted small me-2">标签</span>
        <a
          class="badge bg-light text-muted me-2 mb-2 text-decoration-none"
          th:each="momentTag : ${moment.spec.tags}"
          th:href="@{/moments(tag=${momentTag})}"
        >
          # [[${momentTag}]]
        </a>
      </section>

      <section
        class="moment-owner mt-4"
        th:if="${moment.owner != null and (moment.owner.displayName != null or moment.owner.bio != null)}"
      >
        <div class="d-flex align-items-center">
          <img
            th:if="${moment.owner.avatar != null}"
            th:src="${moment.owner.avatar}"
            alt="owner-avatar"
            class="rounded-circle me-3"
            width="48"
            height="48"
            loading="lazy"
          />
          <div>
            <div class="fw-semibold" th:text="${moment.owner.displayName != null ? moment.owner.displayName : moment.owner.name}"></div>
            <p class="mb-0 text-muted small" th:text="${moment.owner.bio}"></p>
          </div>
        </div>
      </section>

      <footer class="mt-5 d-flex justify-content-between flex-wrap gap-3">
        <a class="btn btn-outline-secondary" href="/moments">
          <i class="fas fa-arrow-left me-2"></i>
          返回瞬间列表
        </a>
        <span
          class="text-muted small"
          th:if="${moment.metadata != null and moment.metadata.creationTimestamp != null}"
        >
          创建于 [[${#dates.format(moment.metadata.creationTimestamp,'yyyy-MM-dd HH:mm')}]]
        </span>
      </footer>
    </article>
  </div>
</html>
